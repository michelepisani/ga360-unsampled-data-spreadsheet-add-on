<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-9947489-41"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'UA-9947489-41', { 'anonymize_ip': true, 'page_title' : 'modal report schedule', 'page_path': '/modal-report-schedule', 'cookie_flags': 'samesite=none;secure' });
</script>

<script>
function showHide_automateOptionsContainer(chkd) {
    var automate_options_container_id_ref = document.getElementById("automate-options-container");
    if (chkd) {
        automate_options_container_id_ref.style.display='block';
    } else {
        automate_options_container_id_ref.style.display='none';
    }
}

function intervalSelected(opt) {
    var dayOfWeek_container = document.getElementById("dayOfWeek-container");
    var dayOfMonth_container = document.getElementById("dayOfMonth-container");
    var hourOfDay_container = document.getElementById("hourOfDay-container");
    switch(opt.value) {
        case '1':
            hourOfDay_container.style.display='inline';
            dayOfMonth_container.style.display='none';
            dayOfWeek_container.style.display='none';
            break;
        case '2':
            dayOfWeek_container.style.display='inline';
            hourOfDay_container.style.display='inline';
            dayOfMonth_container.style.display='none';
            break;
        case '3':
            dayOfWeek_container.style.display='none';
            dayOfMonth_container.style.display='inline';
            hourOfDay_container.style.display='inline';
            break;
        default:
            hourOfDay_container.style.display='none';
            dayOfWeek_container.style.display='none';
            dayOfMonth_container.style.display='none';
    }
}

function onFailure(error) {
    console.log(error.message);
}

function onSuccessTriggerScheduled(result) {
    closeSidebar();
}

function closeSidebar() {
    google.script.host.close();
}

function scheduleReportByTrigger() {
    var save_trigger_id = document.getElementById("save_trigger");
    save_trigger_id.disabled = true;
    save_trigger_id.value="Saving...";
    google.script.run.withFailureHandler(onFailure).withSuccessHandler(onSuccessTriggerScheduled).scheduleReportByTrigger(document.forms[0]);
}

function onSuccessTriggerScheduledDetails(result) {
    if (result) {
        var arr_trigger_setup = result.split("|");
        var t_interval = arr_trigger_setup[0];
        var t_dayOfWeek = arr_trigger_setup[1];
        var t_dayOfMonth = arr_trigger_setup[2];
        var t_hourOfDay = arr_trigger_setup[3];

        var chk_automate_id_ref = document.getElementById("automate");
        var automate_options_container_id_ref = document.getElementById("automate-options-container");
        var dayOfWeek_container = document.getElementById("dayOfWeek-container");
        var dayOfMonth_container = document.getElementById("dayOfMonth-container");
        var hourOfDay_container = document.getElementById("hourOfDay-container");
        var sel_interval = document.getElementById("interval");
        var sel_dayOfWeek = document.getElementById("dayOfWeek");
        var sel_dayOfMonth = document.getElementById("dayOfMonth");
        var sel_hourOfDay = document.getElementById("hourOfDay");
        
        chk_automate_id_ref.checked = true;
        automate_options_container_id_ref.style.display='block';
        sel_interval.selectedIndex = t_interval-1; // il -1 è dovuto l fatto che l'indice inizialmente era lo 0 per l'intervallo ma avendo tolto la frequenza oraria (perché presente di default) devo scalare di 1
        
        switch(t_interval) {
            case '1':
                hourOfDay_container.style.display='inline';
                dayOfMonth_container.style.display='none';
                dayOfWeek_container.style.display='none';
                sel_hourOfDay.selectedIndex = t_hourOfDay;
                break;
            case '2':
                dayOfWeek_container.style.display='inline';
                hourOfDay_container.style.display='inline';
                dayOfMonth_container.style.display='none';
                sel_dayOfWeek.selectedIndex = t_dayOfWeek;
                sel_hourOfDay.selectedIndex = t_hourOfDay;
                break;
            case '3':
                dayOfWeek_container.style.display='none';
                dayOfMonth_container.style.display='inline';
                hourOfDay_container.style.display='inline';
                sel_dayOfMonth.selectedIndex = t_dayOfMonth;
                sel_hourOfDay.selectedIndex = t_hourOfDay;
                break;
            default:

        }
        
    }
}

google.script.run.withFailureHandler(onFailure).withSuccessHandler(onSuccessTriggerScheduledDetails).getScheduleTriggerDetails();

</script>

<form id="schedule">

    <div id="automate-container" class="form-row">
      <label>
        <input name="automate" type="hidden" value="0" />
        <input id="automate" name="automate" type="checkbox" value="1" onclick="showHide_automateOptionsContainer(this.checked);" />
        Enable reports to run automatically.
      </label>
    </div>

    
<div class="form-row" id="automate-options-container" style="display: none;">

      
<label id="interval-container">
        Schedule reports to run
        <select id="interval" name="interval" onchange="intervalSelected(this)">
                      <!--<option value="0">every hour</option>-->
                      <option value="1">every day</option>
                      <option value="2">every week</option>
                      <option value="3">every month</option>
                  </select>
      </label>

      
<label id="dayOfWeek-container" style="display: none;">on
        <select id="dayOfWeek" name="dayOfWeek">
                      <option value="0">Monday</option>
                      <option value="1">Tuesday</option>
                      <option value="2">Wednesday</option>
                      <option value="3">Thursday</option>
                      <option value="4">Friday</option>
                      <option value="5">Saturday</option>
                      <option value="6">Sunday</option>
                  </select>
      </label>

      <label id="dayOfMonth-container" style="display:none">on the
        
<select id="dayOfMonth" name="dayOfMonth">
                      <option value="0">1st</option>
                      <option value="1">2nd</option>
                      <option value="2">3rd</option>
                      <option value="3">4th</option>
                      <option value="4">5th</option>
                      <option value="5">6th</option>
                      <option value="6">7th</option>
                      <option value="7">8th</option>
                      <option value="8">9th</option>
                      <option value="9">10th</option>
                      <option value="10">11th</option>
                      <option value="11">12th</option>
                      <option value="12">13th</option>
                      <option value="13">14th</option>
                      <option value="14">15th</option>
                      <option value="15">16th</option>
                      <option value="16">17th</option>
                      <option value="17">18th</option>
                      <option value="18">19th</option>
                      <option value="19">20th</option>
                      <option value="20">21st</option>
                      <option value="21">22nd</option>
                      <option value="22">23rd</option>
                      <option value="23">24th</option>
                      <option value="24">25th</option>
                      <option value="25">26th</option>
                      <option value="26">27th</option>
                      <option value="27">28th</option>
                      <option value="28">29th</option>
                      <option value="29">30th</option>
                      <option value="30">31st</option>
                  </select>
      </label>

      <label id="hourOfDay-container">between
        <select id="hourOfDay" name="hourOfDay">
                      <option value="0">midnight &nbsp;–&nbsp; 1 a.m.</option>
                      <option value="1">1 a.m. &nbsp;–&nbsp; 2 a.m.</option>
                      <option value="2">2 a.m. &nbsp;–&nbsp; 3 a.m.</option>
                      <option value="3">3 a.m. &nbsp;–&nbsp; 4 a.m.</option>
                      <option value="4">4 a.m. &nbsp;–&nbsp; 5 a.m.</option>
                      <option value="5">5 a.m. &nbsp;–&nbsp; 6 a.m.</option>
                      <option value="6">6 a.m. &nbsp;–&nbsp; 7 a.m.</option>
                      <option value="7">7 a.m. &nbsp;–&nbsp; 8 a.m.</option>
                      <option value="8">8 a.m. &nbsp;–&nbsp; 9 a.m.</option>
                      <option value="9">9 a.m. &nbsp;–&nbsp; 10 a.m.</option>
                      <option value="10">10 a.m. &nbsp;–&nbsp; 11 a.m.</option>
                      <option value="11">11 a.m. &nbsp;–&nbsp; noon</option>
                      <option value="12">noon &nbsp;–&nbsp; 1 p.m.</option>
                      <option value="13">1 p.m. &nbsp;–&nbsp; 2 p.m.</option>
                      <option value="14">2 p.m. &nbsp;–&nbsp; 3 p.m.</option>
                      <option value="15">3 p.m. &nbsp;–&nbsp; 4 p.m.</option>
                      <option value="16">4 p.m. &nbsp;–&nbsp; 5 p.m.</option>
                      <option value="17">5 p.m. &nbsp;–&nbsp; 6 p.m.</option>
                      <option value="18">6 p.m. &nbsp;–&nbsp; 7 p.m.</option>
                      <option value="19">7 p.m. &nbsp;–&nbsp; 8 p.m.</option>
                      <option value="20">8 p.m. &nbsp;–&nbsp; 9 p.m.</option>
                      <option value="21">9 p.m. &nbsp;–&nbsp; 10 p.m.</option>
                      <option value="22">10 p.m. &nbsp;–&nbsp; 11 p.m.</option>
                      <option value="23">11 p.m. &nbsp;–&nbsp; midnight</option>
                  </select>
      </label>

    </div>

    <div class="form-action">
      <input type="button" onClick="scheduleReportByTrigger();" value="Save" class="action" id="save_trigger" />
      <input type="button" onClick="google.script.host.close();" value="Cancel" />
    </div>
  </form>
  
  <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons.css" />
  <style>
  body {margin: 0;}
  form {overflow: hidden;}
  select {margin: 0 6px;padding-left: 6px;}
  .form-row {margin: 10px 0 20px;}
  .form-action {margin: 30px 0 0;}
  </style>